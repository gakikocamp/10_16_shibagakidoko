<!DOCTYPE html>
<html lang="ja">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>KINOKOCAMP - AR CAMPING</title>

  <!-- Bootstrap core CSS -->
  <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom fonts for this template -->
  <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
  <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800'
    rel='stylesheet' type='text/css'>

  <!-- Custom styles for this template -->
  <link href="css/clean-blog.css" rel="stylesheet">

  <!-- グーグルマップAPI -->
  <script src="http://maps.google.com/maps/api/js?key=AIzaSyBunFa8M5cUXVfE2ewS5ZCueUIh-AxtB5Y&language=ja"></script>

</head>

<!-- <body onLoad="test(), testb()"> -->

<body>

  <!-- ナビゲーション -->
  <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
    <div class="container">
      <a class="navbar-brand" href="index.html">KINOKO CAMP Inc.</a>
      <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive"
        aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
        Menu
        <i class="fas fa-bars"></i>
      </button>
      <div class="collapse navbar-collapse" id="navbarResponsive">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item">
            <a class="nav-link" href="index.html">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="about.html">About</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="post.html">VRCAMP</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="contact.html">Contact</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- ヘッダー -->
  <header class="masthead" style="background-image: url('img/post-bg2.jpg')">
    <div class="overlay"></div>
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-md-10 mx-auto">
          <div class="post-heading">
            <h1>Let's scratch the photo!</h1>
            <h2 class="subheading">昼夜の変化がわかる「キャンプスクラッチ」</h2>


          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- 本文 -->
  <article>
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-md-10 mx-auto">

          <h2 class="section-heading">▼▼下の画像をこすってみてね▼▼</h2>

          <p>【おまけ】

            富士山が見えるふもとっぱらキャンプ場で</p>
          <p>昼と夜２つの違いを「キャンプスクラッチ」で体験してみよう</p>

          <p>～あなたは「昼キャン派？」「夜キャン派？」～</p>


          <!-- <h2 class="section-heading">↓↓ここを擦ると昼になるよ↓↓</h2> -->


          <div class="canvas-wrapper">
            <!-- やっぱり駄目だったやりかた -->
            <!-- <canvas class="canvas" id="canvas1"></canvas>
            <input class="file" id="file1" type="file" />
            <canvas class="canvas" id="drowarea"></canvas>
            <input class="file" id="file2" type="file" /> -->


            <!-- <img class="img-fluid" src="img/post-sample-image1.jpg" alt=""> -->
            <div>
              <canvas class="canvas" id="drowareaback" width="610" height="407"></canvas>
            </div>
            <div>
              <canvas class="canvas" id="drowarea" width="610" height="407"></canvas>
            </div>



            <!-- <canvas id="drowarea" width="500" height="500" style="border:1px solid blue;"></canvas> -->
            <!-- <canvas id="drowarea1"></canvas> -->

            <!-- <div class=canva> -->

            <!-- <canvas id="drowarea2" width="800" height="500"></canvas> -->
            <!-- </div> -->
          </div>



        </div>
      </div>
    </div>
  </article>

  <hr>

  <!-- Footer ここは丸々コピペのおしゃれフッター -->
  <footer>
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-md-10 mx-auto">
          <ul class="list-inline text-center">
            <li class="list-inline-item">
              <a href="#">
                <span class="fa-stack fa-lg">
                  <i class="fas fa-circle fa-stack-2x"></i>
                  <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
                </span>
              </a>
            </li>
            <li class="list-inline-item">
              <a href="#">
                <span class="fa-stack fa-lg">
                  <i class="fas fa-circle fa-stack-2x"></i>
                  <i class="fab fa-facebook-f fa-stack-1x fa-inverse"></i>
                </span>
              </a>
            </li>
            <li class="list-inline-item">
              <a href="#">
                <span class="fa-stack fa-lg">
                  <i class="fas fa-circle fa-stack-2x"></i>
                  <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                </span>
              </a>
            </li>
          </ul>
          <p class="copyright text-muted">Copyright &copy; KINOKOCAMP 2019</p>
        </div>
      </div>
    </div>
  </footer>

  <!-- Bootstrap core JavaScript -->
  <script src="vendor/jquery/jquery.min.js"></script>
  <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

  <!-- Custom scripts for this template -->
  <script src="js/clean-blog.min.js"></script>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js "></script>

  <script>




    //初期化
    var draw = false;             //スイッチ：true=線を引く, false=線は引かない
    var txy = 0;                    //描画位置の調整，iPadなどは15＋すると良いかも
    var oldX = 0;                   //１つ前の座標を代入するための変数
    var oldY = 0;                   //１つ前の座標を代入するための変数
    var bold_line = 120;              //ラインの太さ
    var color = '#000';             //ラインの色
    var alpha = 1;                  //ラインの透明度

    // キャンバスの準備
    var can = $('#drowarea')[0];        //CanvasElement
    var canb = $('#drowareaback')[0];        //CanvasElement

    var context = can.getContext('2d'); //描画するための準備！
    var contextb = canb.getContext('2d'); //描画するための準備！


    // キャンバスに画像を載せる
    window.onload = function () {
      test();
      testb();
    }

    // onload = function () {
    //   draw();
    // };

    // function draw() {
    //   var canvas = document.getElementById('c1');
    //   if (!canvas || !canvas.getContext) { return false; }
    //   var ctx2 = canvas.getContext('2d');
    //   /* Imageオブジェクトを生成 */
    //   var img = new Image();
    //   img.src = "img/post-sample-image1n.jpg" + new Date().getTime();
    //   /* 画像が読み込まれるのを待ってから処理を続行 */
    //   img.onload = function () {
    //     ctx2.drawImage(img, 0, 0);
    //   }
    // }

    // onload = function () {
    //   draw();
    // };


    // ここうまくいかない
    var imgback = new Image();
    imgback.src = "img/post-sample-image1.jpg";

    function testb() {
      //描画コンテキストの取得
      // var cvsb = document.getElementById('drowareaback');
      // if (cvsb.getContext) {
      // var ctxb = cvsb.getContext('2d');
      //座標(0, 0)の位置にイメージを表示
      contextb.drawImage(imgback, 0, 0, 610, 407);//610x407に縮小表示
      // }
    }


    // 消せるほうの画像
    var img01 = new Image();
    img01.src = "img/post-sample-image1n.jpg";

    function test() {
      //描画コンテキストの取得
      // var cvs = document.getElementById('drowarea');
      // if (cvs.getContext) {
      // var ctx = cvs.getContext('2d');
      //座標(0, 0)の位置にイメージを表示
      context.drawImage(img01, 0, 0, 610, 407);//610x407に縮小表示
      // }
      context.globalCompositeOperation = 'destination-out';
    }







    // function draw() {
    //   //2Dコンテキストのオブジェクトを生成する
    //   var cvs = document.getElementById('drowarea');
    //   var ctx1 = cvs.getContext('2d');

    //   //画像オブジェクトを生成し先読みする
    //   var img = new Image();
    //   img.src = "img/post-sample-image1n.jpg";

    //   //画像をcanvasに設定
    //   img.onload = function () {
    //     ctx1.drawImage(img, 0, 0, 610, 407);  //800x500に縮小表示

    //   }
    // }

    // function test() {
    //   //描画コンテキストの取得
    //   var canvas = document.getElementById('sample');
    //   if (canvas.getContext) {
    //     var context = canvas.getContext('2d');
    //     //座標(10, 10)の位置にイメージを表示
    //     context.drawImage(img, 0, 0);
    //   }
    // }





    //MouseDownイベント：フラグをTrue(クリック状態のときだけ線を書きたいため)
    $(can).on('mousedown', function (e) {
      console.log(e);
      // 座標を取得して描画状態にする処理を記述
      oldX = e.offsetX;
      oldY = e.offsetY - txy;
      draw = true;
    });

    //MouseMove：動かしてラインを引く処理
    $(can).on('mousemove', function (e) {
      console.log(e)
      //  【注意】mousedownはクリックしていてもいなくても発火するので条件分岐する必要あり！
      if (draw == true) {
        context.strokeStyle = color;    //色
        context.lineWidth = bold_line;  //太さ
        context.globalAlpha = alpha;    //透明度
        context.lineJoin = 'round';     //線の接続部
        context.lineCap = 'round';      //線の端の形
        // 線を引く処理を記述
        context.beginPath();
        context.moveTo(oldX, oldY);
        context.lineTo(e.offsetX, e.offsetY - txy);
        context.stroke();


        // 一つ前の座標に現在の座標を保存する処理を記述
        oldX = e.offsetX;
        oldY = e.offsetY - txy;

      }
    });

    //MouseUpフラグをfalse
    $(can).on('mouseup', function (e) {
      // 描かなくする処理

      draw = false;

    });

    //カーソルがキャンバスから外れると描画を中止する処理
    $(can).on('mouseout', function (e) {
      // 描かなくする処理
      draw = false;

    });

    //線の太さスケール(線の太さを変更する処理)
    $('#bold').on('change', function (e) {
      console.log('太さ変更！');

      bold_line = $('#bold').val();
      console.log(bold_line);
      // 太さを設定する処理

    });

    //透明度スケール(線の透明度を変更する処理)
    $('#alpha').on('change', function (e) {
      console.log('透明度を変更！');
      // 透明度を設定する処理

      alpha = $('#alpha').val();
      console.log(alpha);
    });

    //カラーボタン(線の色を変更する処理)
    $('#color').on('change', function (e) {
      console.log('色変更！');


      color = $('#color').val();
      console.log(color);
      // 色を設定する処理

    });

    //ペン(線を書く状態にする処理，デフォルトでは線を書く状態)
    $('#pen').on('click', function (e) {
      console.log('ペンモードです！');
      // ペンの状態にする処理
      context.globalCompositeOperation = 'source-over';
    });

    //消しゴム(書いた線を消去する状態にする処理)
    $('#erase').on('click', function (e) {
      console.log('消しゴムモードです！');
      // 消しゴムの状態にする処理
      context.globalCompositeOperation = 'destination-out';
      // color = '#fff';

    });

    // 戻るボタン(高難度！！ここ以外でもいろいろな処理が必要です！！)



    // ここできてません


    $('#back').on('click', function () {

      //履歴を保管する配列
      const history = [];
      //履歴の上限数
      const limit = 5;

      //履歴取得
      history.push(context.getImageData(0, 0, can.width, can.height));
      if (history.length > limit) {
        history.shift();
      }

      //履歴書き戻し
      const id = history.pop();
      if (id) {
        context.putImageData(id, 0, 0);
      }


    });

    //クリアボタン(キャンバスの内容を消去)
    $('#clear_btn').on('click', function (e) {
      console.log('クリア！');
      context.beginPath();
      // 消去する処理を記述
      context.clearRect(0, 0, can.width, can.height)
    });


  </script>


</body>

</html>